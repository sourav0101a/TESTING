<aura:component implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickActionWithoutHeader" access="global">
    
    <lightning:workspaceAPI aura:id="workspace" />
    <lightning:navigation aura:id="navService"/>

    <!-- Custom component -->
    <c:scnewcase aura:id="ncase" onalerteventcase="{!c.closeModal}" oncreatecaseevents="{!c.openCaseEdit}" />

    <!-- Confirmation Modal -->
    <aura:if isTrue="{!v.showConfirmation}">
        <div class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick="{!c.handleClose}">
                        <lightning:icon iconName="utility:close" alternativeText="close" size="small"/>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <h2 class="slds-text-heading_medium">Confirm</h2>
                </header>
                <div class="slds-modal__body">
                    <p>Are you sure you want to create a case?</p>
                </div>
                <footer class="slds-modal__footer">
                    <lightning:button variant="neutral" label="No" onclick="{!c.handleNo}" />
                    <lightning:button variant="brand" label="Yes" onclick="{!c.handleYes}" />
                </footer>
            </div>
        </div>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>

    <aura:handler name="init" value="{!this}" action="{!c.init}"/>
</aura:component>

({
    init : function(component, event, helper) {
        // Initialize component attributes
        component.set("v.showConfirmation", false);
    },

    createCaseCall : function(component, event, helper) {
        console.log("entered aura controller");
        
        // Check if confirmation is already shown
        if (!component.get("v.showConfirmation")) {
            component.set("v.showConfirmation", true);
        }
    },

    handleClose : function(component, event, helper) {
        // Close the modal
        component.set("v.showConfirmation", false);
    },

    handleNo : function(component, event, helper) {
        // User clicked "No", so close the modal
        component.set("v.showConfirmation", false);
    },

    handleYes : function(component, event, helper) {
        // User clicked "Yes", so proceed with creating the case
        component.set("v.showConfirmation", false);

        // Call the create case logic after confirmation
        var recId = component.get("v.recordId");
        var lwcRef = component.find("ncase");
        lwcRef.newCaseContact(recId);
    },

    closeModal : function(component, event) {
        console.log('entered alert event');
        $A.get("e.force:closeQuickAction").fire();
    },

    openCaseEdit : function(component, event) {
        console.log('Entered Aura Event');
        console.log('Value of params: ' + event);
        var workspaceAPI = component.find("workspace");
        var subTabURL = event.getParam('urlToOpen');
        console.log('value of subTabURL: ' + subTabURL);
        var parentTab;
        workspaceAPI.getEnclosingTabId().then(function(tabId) {
            console.log(tabId);
            parentTab = tabId;
        })
        .catch(function(error) {
            console.log(error);
        });
        workspaceAPI.openSubtab({
                parentTabId: parentTab,
                recordId: subTabURL,
                focus: true,
        });
        $A.get("e.force:closeQuickAction").fire(); 
    }
})
