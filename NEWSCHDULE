@isTest
private class TestServiceBatchERTUpdate {

    static testMethod void testBatchExecution() {
        // Create test data
        List<Case> testCases = new List<Case>();
        for (Integer i = 0; i < 10; i++) {
            Case c = new Case(
                Likely_Restoration_Time__c = DateTime.now().addDays(-1), // Ensure Likely_Restoration_Time__c is in the past
                Cause__c = 'Test Cause ' + i,
                Diagnosis_Summary__c = 'Test Diagnosis ' + i,
                Number_of_Instruments_Queried__c = 1,
                Case_Owner_Name__c = 'Test Owner ' + i
            );
            testCases.add(c);
        }
        insert testCases;

        Test.startTest();

        // Schedule the batch job
        ServiceBatchERTUpdate batchJob = new ServiceBatchERTUpdate();
        String cronExp = '0 0 0 * * ?'; // Run daily at midnight
        String jobId = system.schedule('Test Service Batch ERT Update', cronExp, batchJob);

        Test.stopTest();

        // Verify results
        List<Case> updatedCases = [SELECT Id, Likely_Restoration_Time__c FROM Case WHERE Id IN :testCases];
        System.assert(!updatedCases.isEmpty(), 'Expected some cases to be updated');

        for (Case c : updatedCases) {
            // Verify that Likely_Restoration_Time__c is updated correctly
            System.assertEquals(DateTime.now().addDays(6).date(), c.Likely_Restoration_Time__c.date(),
                                'Likely Restoration Time not updated correctly');
        }
    }
}
Test failure, method: OpportunityTriggerGenericHelperTest.genericAfterInsert -- System.DmlException: Update failed. First exception on row 0 with id 0067600000A9HPhAAN; first error: FIELD_CUSTOM_VALIDATION_EXCEPTION, FINRA Registered User required on REDI opportunity.Please add FINRA Registered User to the opportunity sales team before moving the Sales Stage to 3 and above.: [] stack Class.OpportunityTriggerGenericHelperTest.genericAfterInsert: line 953, column 1
