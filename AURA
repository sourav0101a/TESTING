import { api, LightningElement } from 'lwc';
import newCase from '@salesforce/apex/SC_CommonLEX.newCase';
import LightningAlert from 'lightning/alert';
import { NavigationMixin } from 'lightning/navigation';

export default class Scnewcase extends NavigationMixin(LightningElement) {
    @api resType;
    @api resMsg;

    @api
    newCaseContact(contactId) {
        console.log('value of contactId: ' + contactId);
        
        newCase({ conId: contactId })
            .then(result => {
                let conts = result;
                let indexVal = conts.indexOf(",");
                this.resType = conts.slice(0, indexVal);
                this.resMsg = conts.slice(indexVal + 1);

                if (this.resType === 'URL') {
                    this.navigateToRecordPage(this.resMsg);
                } else if (this.resType === "alert") {
                    LightningAlert.open({
                        message: this.resMsg,
                        theme: 'error',
                        label: 'Error!',
                    }).then(() => {
                        this.dispatchEvent(new CustomEvent('alertmodalclose'));
                    });
                } else if (this.resType === 'URL') {
                    this.dispatchEvent(new CustomEvent('createcaseevents', {
                        detail: {
                            urlToOpen: this.resMsg,
                            name: 'OpenPage'
                        }
                    }));
                } else {
                    console.log('Error during case creation');
                }
            })
            .catch(error => {
                console.log('Error: ' + error);
            });
    }

    navigateToRecordPage(caseId) {
        this[NavigationMixin.Navigate]({
            type: 'standard__recordPage',
            attributes: {
                recordId: caseId,
                objectApiName: 'Case',
                actionName: 'view'
            }
        }).then(() => {
            // Ensure event is dispatched after navigation
            this.dispatchEvent(new CustomEvent('alertmodalclose'));
        });
    }
}
